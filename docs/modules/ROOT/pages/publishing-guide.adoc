= NPM Publishing Guide
:description: Best practices for publishing the Iconify Picker plugin to the NPM registry.

This guide outlines the workflow for releasing new versions of the `@sunny-pirate/strapi-plugin-iconify-picker`. It covers both manual publishing with Two-Factor Authentication (2FA) and automated delivery via GitHub Actions.

== Versioning Principles

We follow link:https://semver.org/[Semantic Versioning (SemVer)]. Before publishing, determine the type of change:

*   **Patch**: Backward-compatible bug fixes.
*   **Minor**: Backward-compatible new features.
*   **Major**: Breaking changes.

== Automated Publishing (Recommended)

The project is pre-configured with a GitHub Action to automate the release process. This method is preferred as it avoids manual 2FA entry during the CI/CD pipeline.

=== Configuration

1.  **Enable Trusted Publisher on npmjs.com**:
    *   Navigate to your package **Settings** > **Publishing Access**.
    *   Find the **Trusted Publisher** section.
    *   Select **GitHub Actions** and configure:
        ** **Organization/User**: `Sunny-Pirate`
        ** **Repository**: `strapi-plugin-iconify-picker`
        ** **Workflow filename**: `publish.yml` (deve coincidere esattamente).
2.  **Workflow Permissions**:
    *   Il file `.github/workflows/publish.yml` deve avere i permessi `id-token: write` e `contents: read`.
    *   Questo permette a GitHub di generare token OIDC temporanei e firmati crittograficamente, eliminando la necessità di token npm a lungo termine.

=== Provenance (Attestazione di Origine)

Utilizzando il Trusted Publishing, npm genera automaticamente le **Provenance Attestations**. Questo fornisce una prova crittografica della provenienza del pacchetto, permettendo agli utenti di verificare che il codice sia stato effettivamente costruito nel workflow autorizzato.

=== Execution

Per innescare il rilascio, basta creare e pushare un tag:

```bash
# Incrementa la versione e crea il tag
npm version patch

# Pusha i cambiamenti e i tag
git push origin master --tags && git push origin master
```

[IMPORTANT]
====
**Requisiti Tecnici**: Il Trusted Publishing richiede **npm CLI v11.5.1** o superiore. Il nostro workflow è configurato per aggiornare automaticamente npm all'ultima versione disponibile.
====

== Security Best Practices

*   **Preferisci OIDC ai Token**: I token OIDC sono a breve scadenza e legati specificamente al workflow, riducendo drasticamente il rischio di compromissione.
*   **Restrizione Accessi**: Una volta configurato il Trusted Publisher, è consigliabile impostare il package su npmjs.com per escludere l'uso di token tradizionali nelle impostazioni di "Publishing Access".
*   **Audit Periodico**: Controlla regolarmente le configurazioni dei Trusted Publishers e rimuovi eventuali token di automazione non più necessari.

== Manual Publishing (Fallback)

Se devi pubblicare manualmente, dovrai inserire l'OTP della tua app di autenticazione 2FA:

```bash
npm publish --otp=XXXXXX
```

